<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="google-adsense-account" content="pub-7730946066495644" />
  <title>Kobot Pick – 오늘의 AI 추천 포트폴리오</title>
  <meta
    name="description"
    content="AI가 매일 해외·국내·ETF 종목을 분석해서 Top 5를 추천해드립니다."
  />
  <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="/css/styles.css" />
  <!-- Google Analytics (GA4) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BTLSBL36Y3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag("js", new Date());
    // 기본 페이지뷰
    gtag("config", "G-BTLSBL36Y3", {
      page_path: window.location.pathname,
      page_title: document.title,
    });
    // 관심목록 클릭 이벤트
    document.addEventListener("DOMContentLoaded", () => {
      const favBtn = document.getElementById("fav-scroll");
      if (favBtn) {
        favBtn.addEventListener("click", () => {
          gtag("event", "favorites_click", { location: "hero_toolbar" });
        });
      }
      // 언어 변경 이벤트
      const langSelect = document.querySelector(".lang-select");
      if (langSelect) {
        langSelect.addEventListener("change", (e) => {
          gtag("event", "language_change", { value: e.target.value });
        });
      }
      // 검색 입력 focus 이벤트
      const searchInput = document.getElementById("search-input");
      if (searchInput) {
        searchInput.addEventListener("focus", () => {
          gtag("event", "search_focus");
        });
        // 검색 제출 이벤트 (엔터/아이콘 클릭 모두 포함, 메인 JS에서 호출 전송)
        const fireSearch = () => {
          const raw = searchInput.value.trim();
          if (!raw) return;
          const normalized = /^[0-9]{6}$/.test(raw) ? `${raw}.KS` : raw.toUpperCase();
          gtag("event", "search", {
            search_term: raw,
            normalized_ticker: normalized,
          });
        };
        searchInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter") fireSearch();
        });
        const searchIcon = document.querySelector(".search-icon");
        if (searchIcon) {
          searchIcon.addEventListener("click", fireSearch);
        }
      }
    });
  </script>

  <!-- 백엔드 깨우기 & API Base 설정 (중요) -->
  <script>
    const host = window.location.hostname;
    const isStg =
      host.includes("kobot-pick-stg") ||
      host.includes("stg.vercel.app") ||
      host.includes("kobotpick-stg.onrender.com");
    // Render 서버 콜드스타트 방지 (stg/prod 모두)
    const warmupBase = isStg
      ? "https://kobotpick-stg.onrender.com"
      : "https://kobotpick.onrender.com";
    fetch(`${warmupBase}/warmup`).catch(() => {});
    fetch(`${warmupBase}/warmup`).catch(() => {});
    // JS에서 사용하는 공통 API Base
    window.KOBOT_API_BASE_URL = `${warmupBase}/api/v1`;
  </script>
</head>
<body>
  <div class="app-root">
    <!-- Hero -->
    <header class="hero">
      <div class="hero-left">
        <div class="brand-mark">KP</div>
        <div class="hero-titles">
          <p class="eyebrow">AI STOCK PICKER</p>
          <h1 class="hero-title">오늘의 AI 추천 포트폴리오</h1>
          <p class="hero-sub">
            매일 한 번, <strong>해외 · 국내 · ETF</strong> 종목을 한 눈에 확인하세요.
          </p>
        </div>
      </div>
      <div class="hero-right">
        <select class="lang-select" aria-label="언어 선택">
          <option value="ko" selected>한국어 · KR</option>
          <option value="en">English · US</option>
        </select>
        <div class="hero-badge">
          <span class="hero-badge-dot"></span>
          LIVE 추천 업데이트
        </div>
      </div>
    </header>

    <!-- Toolbar -->
    <div class="toolbar">
      <div class="toolbar-left">
        <div class="chip chip-primary">
          <span class="chip-dot"></span>
          오늘의 Top Picks
        </div>
        <div class="chip">
          <span class="chip-dot"></span>
          US · 성장주 중심
        </div>
        <div class="chip">
          <span class="chip-dot"></span>
          KR · 국내 핵심 종목
        </div>
        <div class="chip">
          <span class="chip-dot"></span>
          ETF · 묶음 투자
        </div>
      </div>
      <div class="toolbar-right">
        <div class="search">
          <input
            class="search-input"
            type="text"
            placeholder="티커 또는 종목명을 검색 (예: TSLA, 삼성전자)"
            aria-label="종목 검색"
            id="search-input"
          />
          <span class="search-icon">🔍</span>
        </div>
        <button class="fav-btn" type="button" id="fav-scroll">
          <span class="fav-btn-icon">★</span>
          내 관심 목록
        </div>
      </div>
    </div>

    <!-- 광고 영역 (상단) -->
    <div class="ad-placeholder subtle" style="margin-top: 16px;">
      <div class="ad-chip">Ad</div>
      <div>
        <div class="ad-title">상단 광고 영역</div>
        <div class="ad-desc">승인 후 광고가 노출됩니다.</div>
        <div class="ad-id">Adsense: pub-7730946066495644</div>
      </div>
    </div>

    <!-- 관심 목록 -->
    <section class="card stock-section" id="fav-section">
      <div class="section-header">
        <div class="section-title">
          <span class="icon-badge">★</span>
          내 관심 목록
        </div>
        <div class="section-sub">좋아요를 누른 종목이 여기에 모입니다.</div>
      </div>
      <div id="favorites-list" class="stock-list empty-state">아직 추가된 종목이 없습니다.</div>
    </section>

    <!-- JS에서 쓰는 로딩 영역 -->
    <div id="loading" class="loading" aria-live="polite"></div>

    <!-- Main dashboard grid -->
    <main class="dashboard-grid">
      <!-- Left: Picks -->
      <section>
        <div class="card stock-section">
          <div class="section-header">
            <div class="section-title">
              <span class="icon-badge">US</span>
              미국 Top Picks
            </div>
            <div class="section-sub">먼저 3개, 더보기로 최대 10개 확인</div>
          </div>
          <div id="us-picks" class="stock-list"></div>
          <div class="section-footer">
            <button class="more-btn" type="button" data-section="us">더보기</button>
            <div id="us-more-area" class="more-area" hidden>
              <div id="us-more-list" class="stock-list"></div>
            </div>
          </div>
        </div>

        <div class="card stock-section">
          <div class="section-header">
            <div class="section-title">
              <span class="icon-badge">KR</span>
              국내 Top Picks
            </div>
            <div class="section-sub">먼저 3개, 더보기로 최대 10개 확인</div>
          </div>
          <div id="kr-picks" class="stock-list"></div>
          <div class="section-footer">
            <button class="more-btn" type="button" data-section="kr">더보기</button>
            <div id="kr-more-area" class="more-area" hidden>
              <div id="kr-more-list" class="stock-list"></div>
            </div>
          </div>
        </div>

        <div class="card stock-section">
          <div class="section-header">
            <div class="section-title">
              <span class="icon-badge">ET</span>
              ETF Top Picks
            </div>
            <div class="section-sub">먼저 3개, 더보기로 최대 10개 확인</div>
          </div>
          <div id="etf-picks" class="stock-list"></div>
          <div class="section-footer">
            <button class="more-btn" type="button" data-section="etf">더보기</button>
            <div id="etf-more-area" class="more-area" hidden>
              <div id="etf-more-list" class="stock-list"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Right: snapshot + headlines -->
      <aside>
        <section class="card snapshot-card">
          <div class="section-header">
            <div class="section-title">
              <span class="icon-badge">M</span>
              시장 스냅샷
            </div>
            <div class="section-sub">지수 · 환율 · 금리 한 눈에</div>
          </div>
          <div id="market-snapshot" class="snapshot-grid"></div>
        </section>

        <section class="card" style="margin-top: 14px;">
          <div class="section-header">
            <div class="section-title">
              <span class="icon-badge">N</span>
              오늘의 헤드라인
            </div>
            <div class="section-sub">주요 뉴스만 골라서 확인</div>
          </div>
          <div id="headline-track" class="headline-track"></div>
        </section>
      </aside>
    </main>

    <!-- Ad placeholder -->
    <div class="ad-placeholder subtle">
      <div class="ad-chip">Ad</div>
      <div>
        <div class="ad-title">광고 영역 준비중</div>
        <div class="ad-desc">여기에 네이티브/배너 광고가 노출됩니다.</div>
        <div class="ad-id">Adsense Account: pub-7730946066495644</div>
      </div>
    </div>

    <p class="disclaimer">
      이 정보는 AI 알고리즘에 의한 참고용이며, 모든 투자 결정 및 책임은 사용자 본인에게 있습니다.
    </p>
  </div>

  <!-- Scripts -->
  <script src="/js/chart_renderer.js"></script>
  <script src="/js/main_dashboard.js"></script>
</body>
</html>
